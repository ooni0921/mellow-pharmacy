<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mellow PHARMACY</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <style>
        body { font-family: "Pretendard", sans-serif; -webkit-font-smoothing: antialiased; background-color: #f8fafc; }
        .prose h3 { margin-top: 1.5rem; color: #1e3a8a; font-weight: 800; border-left: 4px solid #4338ca; padding-left: 10px; }
        .tab-content { min-height: 250px; }
    </style>
</head>
<body>

    <div id="list-view" class="hidden min-h-screen">
        <header class="py-12 px-6 text-center bg-white border-b border-slate-100 mb-6">
            <h1 class="text-3xl font-black text-indigo-900 italic tracking-tighter">mellow PHARMACY</h1>
            <p class="text-slate-400 text-xs mt-2 uppercase tracking-widest font-semibold">ë³µì•½ ì•ˆë‚´ ë¦¬ìŠ¤íŠ¸</p>
        </header>

        <main class="px-5 max-w-md mx-auto">
            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                <table class="table table-lg w-full">
                    <tbody id="list-body">
                        </tbody>
                </table>
            </div>
            <p class="text-center text-slate-300 text-xs mt-8 pb-10">Â© 2026 mellow PHARMACY. All rights reserved.</p>
        </main>
    </div>

    <div id="detail-view" class="hidden min-h-screen">
        <header class="bg-indigo-700 text-white p-8 rounded-b-[40px] shadow-lg mb-6 text-center sticky top-0 z-10">
            <button onclick="location.href='index.html'" class="btn btn-ghost btn-xs text-indigo-200 mb-2">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            <h1 id="drug-name" class="text-2xl font-bold"></h1>
        </header>

        <main class="px-5 max-w-md mx-auto pb-10">
            <div id="image-container" class="hidden mb-6">
                <div class="card bg-white shadow-xl overflow-hidden rounded-2xl border border-slate-100">
                    <img id="drug-image" src="" alt="Drug" class="w-full h-52 object-contain bg-white p-4" />
                </div>
            </div>

            <div role="tablist" class="tabs tabs-lifted">
                <input type="radio" name="L" role="tab" class="tab" aria-label="ğŸ‡°ğŸ‡· KO" id="tab-KO" checked />
                <div id="content-KO" role="tabpanel" class="tab-content bg-white border-base-300 rounded-box p-6 shadow-sm prose"></div>
                
                <input type="radio" name="L" role="tab" class="tab" aria-label="ğŸ‡ºğŸ‡¸ EN" id="tab-EN" />
                <div id="content-EN" role="tabpanel" class="tab-content bg-white border-base-300 rounded-box p-6 shadow-sm prose"></div>
                
                <input type="radio" name="L" role="tab" class="tab" aria-label="ğŸ‡¨ğŸ‡³ CN" id="tab-CN" />
                <div id="content-CN" role="tabpanel" class="tab-content bg-white border-base-300 rounded-box p-6 shadow-sm prose"></div>
                
                <input type="radio" name="L" role="tab" class="tab" aria-label="ğŸ‡¯ğŸ‡µ JP" id="tab-JP" />
                <div id="content-JP" role="tabpanel" class="tab-content bg-white border-base-300 rounded-box p-6 shadow-sm prose"></div>
            </div>
        </main>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const drugId = params.get('id');

        // ë¡œì»¬ list.json ë¡œë“œ
        fetch('./list.json')
            .then(res => res.json())
            .then(data => {
                if (drugId) {
                    const info = data.find(item => item.id === drugId);
                    renderDetail(drugId, info);
                } else {
                    renderList(data);
                }
            })
            .catch(err => {
                document.body.innerHTML = `<div class='p-10 text-center'>list.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
            });

        // ëª©ë¡ í™”ë©´ ë Œë”ë§
        function renderList(data) {
            const listView = document.getElementById('list-view');
            listView.classList.remove('hidden');
            
            const tbody = document.getElementById('list-body');
            tbody.innerHTML = data.map(item => `
                <tr class="hover:bg-indigo-50 cursor-pointer border-b border-slate-50 transition-colors" onclick="location.href='?id=${item.id}'">
                    <td class="font-mono font-bold text-indigo-400 text-xs w-16">${item.id}</td>
                    <td class="text-slate-800 font-semibold text-lg py-5">${item.name}</td>
                    <td class="text-right text-slate-300">â†’</td>
                </tr>
            `).join('');
        }

        // ìƒì„¸ í™”ë©´ ë Œë”ë§
        function renderDetail(id, info) {
            const detailView = document.getElementById('detail-view');
            detailView.classList.remove('hidden');
            document.getElementById('drug-name').innerText = info ? info.name : "ì˜ì•½í’ˆ ì •ë³´";

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            const imgArea = document.getElementById('image-container');
            const imgTag = document.getElementById('drug-image');
            if (info && info.img) {
                imgTag.src = info.img.startsWith('http') ? info.img : `./images/${info.img}`;
                imgArea.classList.remove('hidden');
            }

            // MD íŒŒì¼ ë¡œë“œ
            fetch(`./medicines/${id}.md`)
                .then(res => res.text())
                .then(text => {
                    const sections = text.split(/#(KO|EN|CN|JP)/);
                    const contents = {};
                    for (let i = 1; i < sections.length; i += 2) {
                        contents[sections[i]] = marked.parse(sections[i + 1].trim());
                    }
                    ['KO', 'EN', 'CN', 'JP'].forEach(lang => {
                        const div = document.getElementById(`content-${lang}`);
                        if (div) div.innerHTML = contents[lang] || "<p class='text-slate-300'>Coming soon</p>";
                    });

                    // ì ‘ì† êµ­ê°€/ì–¸ì–´ ê¸°ë°˜ ìë™ íƒ­ ì„ íƒ
                    const userLang = navigator.language.split('-')[0].toUpperCase();
                    const langMap = { 'KO': 'KO', 'EN': 'EN', 'ZH': 'CN', 'JA': 'JP' };
                    const targetTab = document.getElementById(`tab-${langMap[userLang] || 'EN'}`);
                    if (targetTab) targetTab.checked = true;
                });
        }
    </script>
</body>
</html>